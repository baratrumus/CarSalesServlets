DROP TABLE models IF EXISTS CASCADE;
DROP TABLE brands IF EXISTS CASCADE;

DROP TABLE engines IF EXISTS CASCADE;
DROP TABLE bodytype IF EXISTS CASCADE;

DROP TABLE car IF EXISTS CASCADE;
DROP TABLE roles IF EXISTS CASCADE;
DROP TABLE users IF EXISTS CASCADE;
DROP TABLE ads IF EXISTS CASCADE;



CREATE TABLE brands
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE models
(
--     id INT NOT NULL PRIMARY KEY,
    id INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    brand_id INT NOT NULL references brands(id)
);

-- ALTER TABLE models ADD CONSTRAINT fk_brands FOREIGN KEY(brand_id) REFERENCES brands(id);





CREATE TABLE engine
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);

CREATE TABLE bodytype
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    type VARCHAR(255) NOT NULL
);

CREATE TABLE car
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    brand_id INT NOT NULL references brands(id),
    body_id INT NOT NULL references bodytype(id),
    engine_id INT NOT NULL references engine(id),
    model_id INT NOT NULL references models(id),
    car_year    VARCHAR(255),
    color    VARCHAR(255)
);

CREATE TABLE roles
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    role_name VARCHAR(255)
);


CREATE TABLE users
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    phone VARCHAR(255) NOT NULL,
    role_id INT NOT NULL references roles(id)
);


CREATE TABLE image
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    file_name    VARCHAR(255) NOT NULL,
    content_type VARCHAR(255) NOT NULL,
    data         BLOB(5M)  NOT NULL /*5M maximum for the picture*/
);




CREATE TABLE ads
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    descr     VARCHAR(1000)            NOT NULL,
    created   TIMESTAMP DEFAULT now() NOT NULL,
    fileimage bytea,
    price      VARCHAR(100)            NOT NULL,
    sold       BOOLEAN   DEFAULT false  NOT NULL,
    car_id    INTEGER    REFERENCES car (id) ON DELETE SET NULL,
    user_id   INTEGER    NOT NULL REFERENCES users (id) ON DELETE CASCADE
);